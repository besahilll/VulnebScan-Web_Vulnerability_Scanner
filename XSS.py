import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin

s = requests.Session()
s.headers["User-Agent"] = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"

# Function to get all forms
def get_forms(url):
    soup = BeautifulSoup(s.get(url).content, "html.parser")
    return soup.find_all("form")

# Function to get all links
def get_links(url):
    soup = BeautifulSoup(s.get(url).content, "html.parser")
    links = soup.find_all("a", href=True)
    return [link["href"] for link in links]

def xss_vulnerable(response):
    if response is None:
        return False
    
    xss_strings = ['<script>alert("XSS")</script>',
                   '<img src="x" onerror="alert(\'XSS\')">']
    
    for xss_string in xss_strings:
        if xss_string.lower() in response.content.decode().lower():
            return True
    return False

def xss_scan(url):
    forms = get_forms(url)
    print(f"[+] Detected {len(forms)} forms on {url}.")

    for form in forms:
        details = form_details(form)
        res = None

        for xss_string in ['<script>alert("XSS")</script>', '<img src="x" onerror="alert(\'XSS\')">']:
            data = {}
            for input_tag in details["inputs"]:
                if input_tag["type"] == "hidden" or input_tag["value"]:
                    data[input_tag['name']] = input_tag["value"] + xss_string
                elif input_tag["type"] != "submit":
                    data[input_tag['name']] = f"test{xss_string}"

            if details["method"] == "post":
                res = s.post(url, data=data)
            elif details["method"] == "get":
                res = s.get(url, params=data)

            if xss_vulnerable(res):
                print("XSS vulnerability detected in form on:", url)
                return
    print("No XSS vulnerability detected in forms on:", url)

def form_details(form):
    detailsOfForm = {}
    action = form.attrs.get("action")
    method = form.attrs.get("method", "get")
    inputs = []

    for input_tag in form.find_all("input"):
        input_type = input_tag.attrs.get("type", "text")
        input_name = input_tag.attrs.get("name")
        input_value = input_tag.attrs.get("value", "")
        inputs.append({
            "type": input_type,
            "name": input_name,
            "value": input_value,
        })

    detailsOfForm['action'] = action
    detailsOfForm['method'] = method
    detailsOfForm['inputs'] = inputs
    return detailsOfForm

if __name__ == "__main__":
    urlToBeChecked = input("Enter the URL to be checked: ")
    xss_scan(urlToBeChecked)
